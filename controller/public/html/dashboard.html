<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</head>
<style type="text/css">
     ::-webkit-input-placeholder {
        text-align: center;
    }
    
    :-moz-placeholder {
        /* Firefox 18- */
        text-align: center;
    }
    
    ::-moz-placeholder {
        /* Firefox 19+ */
        text-align: center;
    }
    
    :-ms-input-placeholder {
        text-align: center;
    }
    
    html,
    body {
        width: 100%;
        height: 100%;
        scroll-behavior: smooth;
    }
    
    #results {
        width: 100%;
    }
    
    #addClientsForms {
        text-align: center;
        width: 100%;
        height: 100%;
    }
    
    #addClientsForm {
        display: none;
    }
    
    .addClientForm input {
        border: none;
        width: 45%;
        height: 50px;
        border-radius: 8px;
        display: block;
        margin: 10px;
        background-color: #EBEFF0;
        text-align: center;
    }
    
    #allClients,
    #transactionDiv,
    #profileView,
    #requestMoney {
        height: 100%;
        width: 100%;
        display: none;
    }
    
    #goDashBoard2,
    #goDashBoard3,
    #goDashBoard4,
    #goDashBoard5 {
        margin: 10px;
    }
    
    #requestMoney h4 {
        background-color: #DE9C2B;
        padding: 10px;
        color: white;
    }
    
    .card {
        margin-top: 10px;
        margin-bottom: 10px;
        color: white;
        background: linear-gradient(#141e30, #243b55);
    }
    
    #verification {
        display: inline-block;
    }
    
    @media only screen and (max-width: 600px) {
        #addClientOne {
            width: 90%;
        }
        .addClientForm input {
            width: 90%;
        }
    }
</style>

<body>
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="/">
            <img src="https://media.istockphoto.com/vectors/unique-modern-creative-elegant-letter-d-based-vector-icon-logo-vector-id1125625274?k=6&m=1125625274&s=612x612&w=0&h=U-fRNFEEezcFQ5M8EPjiqUTiqvhHt3lUN2s9CbaVX94=" width="30" height="30" class="d-inline-block align-top"
                alt=""> Digital Ledger
        </a>
        <h5 id="user"></h5>
        <a class="btn btn-danger" href="/logout">Logout</a>
    </nav>
    <section id="results">
        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel" data-interval="5000">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="d-block w-100" src="/img/digix.png" alt="First slide">
                </div>
                <div class="carousel-item">
                    <img class="d-block w-100" src="/img/nextGenration.png" alt="Second slide">
                </div>
            </div>
            <br>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Add Clients</h5>
                                <p class="card-text">Add your customers to database !</p>
                                <a href="#results" id="addClient" class="btn btn-primary">Add</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Business Profile</h5>
                                <p class="card-text">View your profile and details!</p>
                                <a href="#results" id="viewProfile" class="btn btn-primary">View</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">View Clients</h5>
                                <p class="card-text">View all your clients and transactions with them if any !</p>
                                <a href="#results" id="viewClients" class="btn btn-primary">View</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Request New Payment</h5>
                                <p class="card-text">Request new payment from your client!</p>
                                <a href="#" id="newTransaction" class="btn btn-primary">New</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </section>
    <section id="addClientsForm">
        <center>
            <h5>Add Clients</h5>
        </center>
        <div class="container-fluid">
            <center>
                <div class="addClientData">
                    <form action="addClient" method="post" class="addClientForm" id="clientForm">
                        <input type="text" name="clientName" placeholder="Client Name" required>
                        <input type="email" name="clientEmail" placeholder="Client Email" required>
                        <input type="tel" name="clientMobile" placeholder="clientMobile" required maxlength="10">
                        <button class="btn btn-outline-primary" id="clientAdd">Add Client</button>
                    </form>
                    <br>
                    <button class="btn btn-outline-dark" id="goDashBoard">Go To Dashboard</button>
                </div>
            </center>
        </div>
    </section>
    <section id="allClients">
        <button id="goDashBoard2" class="btn btn-outline-dark">Go to Dashboard</button>
        <div class="table-responsive">
            <table class="table table-bordered table-striped" id="clientTable"></table>
        </div>
    </section>
    <section id="transactionDiv">
        <button id="goDashBoard3" class="btn btn-danger">Close</button>
        <div id="verification"></div>
        <div class="table-responsive">
            <table class="table table-bordered table-striped" id="transactionTable"></table>
        </div>
    </section>
    <section id="profileView">
        <button id="goDashBoard4" class="btn btn-outline-dark">Go to Dashboard</button>
    </section>
    <section id="requestMoney">
        <center>
            <h4>Request Payment From Client</h4>
        </center>
        <div class="container-fluid">

            <form class="col-lg-6 offset-lg-3 text-center" id="paymentForm" action="/sendTransactionRequest" method="post">
                <div class="form-group">
                    <label for="exampleFormControlSelect1">Select Client</label>
                    <select class="form-control text-center" name="clientEmail" id="clientSelect" required>
					</select>
                </div>
                <div class="form-group">
                    <label for="exampleFormControlTextarea1">Amount</label>
                    <input type="number" name="amount" min="0" max="999999" class="form-control text-center" id="amountOne" placeholder="â‚¹0" required>
                </div>
                <div class="form-group">
                    <label for="exampleFormControlTextarea1">Remarks</label>
                    <input type="text" name="remarks" maxlength="50" class="form-control text-center" id="remaeksOne" placeholder="Remarks" required>
                </div>
                <button type="submit" id="requestPayment" class="btn btn-primary">Request Payment Via Email</button>
            </form>
        </div>
        <center><button id="goDashBoard5" class="btn btn-outline-dark">Go to Dashboard</button></center>
    </section>
</body>
<script type="text/javascript">
    $(() => {

        $.ajax({
            url: "/getAll",
            method: "get",
            success: function(data) {
                all = data[0];
                businessId = all._id;
                businessName = all.b_name;
                businessMobile = all.b_mobile;
                ownerName = all.b_owner;
                businessEmail = all.b_email;
                totalClients = all.clients.length;
                delete(all);
                $('#user').text('welcome ' + ownerName + '!');
                var profile = `<div class="card">
  <h5 class="card-header">Business Profile</h5>
  <div class="card-body">
    <h5 class="card-title">` + businessName.toUpperCase() + `</h5>
    <p class="card-text">Business Id : ` + businessId + `</p>
    <p class="card-text">Owned By : ` + ownerName.toUpperCase() + `</p>
    <p class="card-text">Business Email : ` + businessEmail + `</p>
    <p class="card-text">Registered Mobile : +91-` + businessMobile + `</p>
  </div>
</div>`;
                $('#profileView').append(profile);
            }
        })

    });
    $('#addClient').click((event) => {
        $('#addClientsForm').css('display', 'block');
        $('#results').css('display', 'none');
    })
    $('#goDashBoard').click((event) => {
        $('#addClientsForm').css('display', 'none');
        $('#results').css('display', 'block');
    })
    $('#viewClients').click(() => {
        $.ajax({
            url: "/getClients",
            method: "get",
            success: (data) => {
                var clientData = `<tr>/
							<th>Client Name</th>
							<th>Client Email</th>/
							<th>Client Mobile</th>/
							<th>Number of Transactions</th>/
							<th>Action</th>/
							</tr>`;
                for (i = 0; i < data.length; i++) {
                    clientData += '<tr>';
                    clientData += '<td>' + data[i].clientName + '</td>';
                    clientData += '<td>' + data[i].clientEmail + '</td>';
                    clientData += '<td>' + data[i].clientMobile + '</td>';
                    clientData += '<td>' + data[i].clientTransactions.length + '</td>';
                    if (data[i].clientTransactions.length == 0) {
                        clientData += '<td><button id="' + i + 'table" class="btn btn-outline-secondary" disabled onclick="displayTransactions(this.id)">No Transactions So Far</button></td>';
                    } else {
                        clientData += '<td><button id="' + i + 'table" class="btn btn-outline-danger" onclick="displayTransactions(this.id)">View Transaction History</button></td>';
                    }

                    clientData += '</tr>';
                }
                $('#clientTable').append(clientData);

            }
        })
        $('#results').css('display', 'none');
        $('#allClients').css('display', 'block');
    })

    function initiateVerification(result) {
        $.ajax({
            url: "/checkValidity",
            method: "post",
            data: {
                "clientEmail": result
            },
            success: (res) => {
                if (res.isOk == false) {
                    $('#row' + res.index + '').css('background-color', '#FF9292');
                    alert('your transaction chain is Compromised !')
                } else {
                    alert('Chain Verified ! No tampering found!');

                }
            }
        })
    }

    function displayTransactions(data) {
        var index = parseInt(data, 10);
        $.ajax({
            url: "/getClients",
            method: "get",
            success: (data) => {
                var tData = `<tr>
		<th>Transaction Id</th>
		<th>TimeStamp</th>
		<th>Amount in Rupees</th>
		<th>Remarks</th>
		<th>Status</th>
		<th>Previous Hash</th>
		<th>Hash</th>
	</tr>`;
                var variable = data[index].clientTransactions;
                for (i = 0; i < variable.length; i++) {
                    tData += '<tr id="row' + i + '">';
                    tData += '<td>' + variable[i]._id + '</td>';
                    tData += '<td>' + variable[i].timeStamp + '</td>';
                    tData += '<td>' + variable[i].amount + '</td>';
                    tData += '<td>' + variable[i].remarks + '</td>';
                    tData += '<td>' + variable[i].status + '</td>';
                    tData += '<td>' + variable[i].previousHash + '</td>';
                    tData += '<td>' + variable[i].hash + '</td>';
                    tData += '</tr>';
                }
                $('#transactionTable').append(tData);
                $('#verification').append('<button id="' + data[index].clientEmail + '" onclick="initiateVerification(this.id)" class="btn btn-success">Verify Transaction Chain</button>')
            }
        })
        $('#allClients').css('display', 'none');
        $('#transactionDiv').css('display', 'block');

    }
    $('#goDashBoard2').click((event) => {
        $('#clientTable').empty();
        $('#allClients').css('display', 'none');
        $('#results').css('display', 'block');
    })
    $('#goDashBoard3').click((event) => {
        $('#verification').empty();
        $('#transactionTable').empty();
        $('#allClients').css('display', 'block');
        $('#transactionDiv').css('display', 'none');
    })
    $('#viewProfile').click((event) => {
        $('#results').css('display', 'none');
        $('#profileView').css('display', 'block');
    })
    $('#goDashBoard4').click((event) => {
        $('#results').css('display', 'block');
        $('#profileView').css('display', 'none');
    })
    $('#newTransaction').click((event) => {
        $.ajax({
            url: "/getClients",
            method: "get",
            success: (data) => {
                clientOptions = '';
                for (i = 0; i < data.length; i++) {
                    clientOptions += '<option>' + data[i].clientEmail + '</option>'
                }
                $('#clientSelect').append(clientOptions);

            }
        })
        $('#results').css('display', 'none');
        $('#requestMoney').css('display', 'block');
    })
    $('#goDashBoard5').click((event) => {
        $('#clientSelect').empty();
        $('#results').css('display', 'block');
        $('#requestMoney').css('display', 'none');
    })
    $('#clientAdd').click((event) => {
        $('#clientForm').submit();
        alert('added client succesfull!');
        $('#clientForm')[0].reset();
    })
    $('#requestPayment').click((event) => {
        $('#paymentForm').submit();
        alert('payment request sent !');
        $('#paymentForm')[0].reset();
    })
</script>

</html>